{% extends 'imageProcessing/base.html' %}

{% block css %}
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/processing_page.css' %}">
{% endblock %}

{% block body %}

    <div class="container-fluid">
        <div class="header">
            <div class="row">
                <h1 class="text-center">Image Processing Demo</h1>
            </div>
        </div>

        <div class="content">
            <div class="row">
                <div class="col-lg-2">
                    <div class="row">
                        <div class="col-lg-1"></div>
                        <div class="col-lg-10">
                            <ul id="hist-thumbnail"></ul>
                        </div>
                        <div class="col-lg-1"></div>

                    </div>
                </div>

                <div class="col-lg-7">
                    {#                       <div> <canvas id="myCanvas"></canvas></div>#}
                    <div id="imageView">

                        <img id="image" class="img-fluid centered"
                             src="data:image/jpeg;charset=utf-8;base64,{{ image_data }}" hidden>
                        <p id="temp-index" hidden>{{ temp_index }}</p>

                    </div>
                    <div id="canvas-wrapper"></div>
                    <div id="canvas-img-data"></div>


                    <div id="histogram"></div>
                    <div id="truncated-histogram"></div>
                    <div id="composition-histogram"></div>

                </div>

                <div class="col-lg-3">

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Laplacian</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_laplacian" type="button">Do laplacian</button>
                        </div>
                        <div class="col-lg-2"></div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Lower threshold</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-lower-thresh" type="range" min="1" max="255" value="30" step="5">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-lower-thresh" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Upper threshold</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-upper-thresh" type="range" min="1" max="255" value="80" step="5">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-upper-thresh" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Kmeans</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-kmeans" type="range" min="1" max="10" value="3" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-kmeans" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>


                    <div class="form-group row">
                        {#                        <div class="col-lg-5">#}
                        {#                            <label class="control-label"> Label of region to extract: </label>#}
                        {#                        </div>#}
                        {#                        <div class="col-lg-3">#}
                        {#                            <input id="crystal_label" type="number" placeholder="2">#}
                        {#                        </div>#}
                        {#                        <div class="col-lg-1"></div>#}
                        {##}
                        {#                        <div class="col-lg-3 centered">#}
                        {#                            <button id="btn_extract_crystal_mask">Extract</button>#}
                        {#                        </div>#}
                        <div class="col-lg-6">
                            <span>Choose region to extract: </span>
                        </div>
                        <div class="col-lg-6">
                            <div class="dropdown" id="label-extraction">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    Show regions
                                </button>
                            </div>


                        </div>

                    </div>
                    {#                     <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#opening">Opening</button>#}
                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Noise removal - set min area threshold: </label>
                        </div>
                        <div class="col-lg-3">
                            <input id="area_thresh" type="number" placeholder="5">
                        </div>
                        <div class="col-lg-1"></div>

                        <div class="col-lg-3 centered">
                            <button id="btn_noise_removal">Remove</button>
                        </div>

                    </div>
                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Opening</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-opening" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-opening" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Closing</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-closing" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-closing" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Erosion</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-erosion" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-erosion" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Dilation</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-dilation" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-dilation" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                                        <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Morph gradient</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-morphgrad" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-morphgrad" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                                        <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Top hat</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-tophat" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-tophat" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>

                                                                <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Black hat</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-blackhat" type="range" min="1" max="15" value="1" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-blackhat" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>
                    </div>


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Fourier Transform</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_fourier" type="button">
                                Do FFT
                            </button>
                        </div>

                        <div class="col-lg-2"></div>
                    </div>


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Back projection</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_backproj" type="button">
                                Do backproj
                            </button>
                        </div>

                        <div class="col-lg-2"></div>
                    </div>

{#                    <div id="opening" class="panel-group" hidden>#}
{#                        <div class="panel panel-default">#}
{#                            <div class="panel-heading">#}
{#                                <h4 class="panel-title">#}
{#                                    <a data-toggle="collapse" href="#opening-collapse-sec">Opening operation</a>#}
{#                                </h4>#}
{#                            </div>#}
{#                            <div id="opening-collapse-sec" class="panel-collapse collapse">#}
{#                                <ul class="list-group">#}
{#                                    <div class="form-group row ">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Opening kernel size</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-opening-kernel" type="range" min="1" max="10" value="3"#}
{#                                                   step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-opening-val-kernel" type="text" placeholder="3" readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{#                                    </div>#}
{##}
{##}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Opening iterations</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-opening-iter" type="range" min="1" max="5" value="1"#}
{#                                                   step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-opening-val-iter" type="text" placeholder="1" readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{#                                </ul>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <div id="closing" class="panel-group" hidden>#}
{#                        <div class="panel panel-default">#}
{#                            <div class="panel-heading">#}
{#                                <h4 class="panel-title">#}
{#                                    <a data-toggle="collapse" href="#closing-collapse-sec">Closing operation</a>#}
{#                                </h4>#}
{#                            </div>#}
{#                            <div id="closing-collapse-sec" class="panel-collapse collapse">#}
{#                                <ul class="list-group">#}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Closing kernel size</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-closing-kernel" type="range" min="1" max="10"#}
{#                                                   value="3" step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-closing-val-kernel" type="text" placeholder="3"#}
{#                                                   readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{#                                    </div>#}
{##}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Closing iterations</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-closing-iter" type="range" min="1" max="5" value="1"#}
{#                                                   step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-closing-val-iter" type="text" placeholder="1" readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{##}
{##}
{#                                </ul>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <div id="erosion" class="panel-group" hidden>#}
{#                        <div class="panel panel-default">#}
{#                            <div class="panel-heading">#}
{#                                <h4 class="panel-title">#}
{#                                    <a data-toggle="collapse" href="#erosion-collapse-sec">Erosion operation</a>#}
{#                                </h4>#}
{#                            </div>#}
{#                            <div id="erosion-collapse-sec" class="panel-collapse collapse">#}
{#                                <ul class="list-group">#}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Erosing kernel size</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-erosion-kernel" type="range" min="1" max="10"#}
{#                                                   value="3" step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-erosion-val-kernel" type="text" placeholder="3"#}
{#                                                   readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{#                                    </div>#}
{##}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Erosion iterations</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-erosion-iter" type="range" min="1" max="5"#}
{#                                                   value="1" step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-erosion-val-iter" type="text" placeholder="1"#}
{#                                                   readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{#                                </ul>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <div id="dilation" class="panel-group" hidden>#}
{#                        <div class="panel panel-default">#}
{#                            <div class="panel-heading">#}
{#                                <h4 class="panel-title">#}
{#                                    <a data-toggle="collapse" href="#dilation-collapse-sec">Dilation#}
{#                                        operation</a>#}
{#                                </h4>#}
{#                            </div>#}
{#                            <div id="dilation-collapse-sec" class="panel-collapse collapse">#}
{#                                <ul class="list-group">#}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Dilation kernel size</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-dilation-kernel" type="range" min="1" max="10"#}
{#                                                   value="3" step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-dilation-val-kernel" type="text"#}
{#                                                   placeholder="3" readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{#                                    </div>#}
{##}
{#                                    <div class="form-group row">#}
{#                                        <div class="col-lg-5">#}
{#                                            <label class="control-label"> Dilation iterations</label>#}
{#                                        </div>#}
{#                                        <div class="col-lg-5">#}
{#                                            <input id="slider-dilation-iter" type="range" min="1" max="5"#}
{#                                                   value="1" step="1">#}
{#                                        </div>#}
{##}
{#                                        <div class="col-lg-2">#}
{#                                            <input id="slider-dilation-val-iter" type="text" placeholder="1"#}
{#                                                   readonly#}
{#                                                   style="border:0; color:#f6931f; font-weight:bold;">#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{#                                </ul>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}

                     <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label">Fill the holes</label>
                        </div>
{##}
{#                         <div class="col-lg-1">#}
{#                            <label class="control-label" for="fill_lo">Lo</label>#}
{#                        </div>#}
{#                         <div class="col-lg-3">#}
{#                            <input class="form-control input-sm" id="fill_lo" type="number">#}
{#                        </div>#}
{##}
{#                         <div class="col-lg-1">#}
{#                            <label class="control-label" for="fill_hi">Hi</label>#}
{#                        </div>#}
{#                        <div class="col-lg-3">#}
{#                            <input class="form-control input-sm" id="fill_hi" type="number">#}
{#                        </div>#}
{##}
{##}
{#                         <div class="col-lg-1">#}
{#                            <label class="control-label" for="fill_conn">Conn</label>#}
{#                        </div>#}
{#                        <div class="col-lg-3">#}
{#                            <input class="form-control input-sm" id="fill_conn" type="number">#}
{#                        </div>#}
{##}
{#                         <div class="col-lg-1">#}
{#                            <label class="control-label" for="fill_fixed_range">Fixed</label>#}
{#                        </div>#}
{#                         <div class="col-lg-3">#}
{#                            <input class="form-control input-sm" id="fill_fixed_range" type="number">#}
{#                        </div>#}
                        <div class="col-lg-3">
                            <button id="btn_fill_hole" type="button">
                                Fill holes
                            </button>
                        </div>

                        <div class="col-lg-2"></div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> All crystals</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_all_crystal" type="button">
                                Show crystals
                            </button>
                        </div>

                        <div class="col-lg-2"></div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Num of top area crystals to
                                extract: </label>
                        </div>
                        <div class="col-lg-3">
                            <input id="num_crystal_label" type="number" placeholder="5">
                        </div>
                        <div class="col-lg-1"></div>

                        <div class="col-lg-3 centered">
                            <button id="btn_extract_top_crystal">Extract</button>
                        </div>

                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            {#                                   <p><label>Drawing tool: <select id="dtool">#}
                            {#        <option value="line">Line</option>#}
                            {#        <option value="rect">Rectangle</option>#}
                            {#        <option value="pencil">Pencil</option>#}
                            {#    </select></label></p>#}
                            <div id="myCanvas-toolbar"></div>
                            <div id="myCanvas-picturepanel"></div>

                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Plot histogram </label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_histogram" type="button">
                                Plot histogram
                            </button>

                        </div>

                        <div class="col-lg-2"></div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Custom histogram </label>
                        </div>
                        <div class="col-lg-2">
                            <input id="hist_min_thresh" type="number" placeholder="min">
                        </div>
                        <div class="col-lg-2">
                            <input id="hist_max_thresh" type="number" placeholder="max">
                        </div>

                        <div class="col-lg-3">
                            <button id="btn_truncated_hist">Plot</button>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Composition </label>
                        </div>
                        <div class="col-lg-2">
                            <input id="comp_a" type="float" placeholder="a value">
                        </div>
                        <div class="col-lg-2">
                            <input id="comp_b" type="float" placeholder="b value">
                        </div>

                        <div class="col-lg-3">
                            <button id="btn_comp">Plot</button>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-2">
                            <button id="btn_undo" type="button" class="btn btn-primary">
                                Undo
                            </button>
                        </div>
                        <div class="col-lg-2">
                            <button id="btn_reset" type="button" class="btn btn-primary">
                                Reset
                            </button>
                        </div>
                    </div>

                    <div id="canvas-toolbar"></div>
                    {#                    <div id="canvas-hidden-wrapper"></div>#}

                    <div class="form-group row">
                        <div class="col-lg-2">
                            <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
                                    data-target="#saveCrystal">Save crystal
                            </button>
                        </div>
                    </div>

                    <!-- Trigger the modal with a button -->


                    <!-- Modal -->
                    <div id="saveCrystal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">Save crystal image?</h4>
                                </div>
                                <div class="modal-body">
                                <form class ="form-horizontal" role ="form">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"
                                                   for="crystal_name">Name</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control"
                                                       id="crystal_name" placeholder="Enter the name here"/>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-sm-offset-2 col-sm-10">
                                                <button id="btn_save_crystal" type="submit" class="btn btn-default">Save
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>

{% endblock %}


{#<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>#}
{#<!--#}
{#<script src="{% static 'js/app.js' %}"></script>#}
{#-->#}

{% block javascript %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    {% load staticfiles %}
    <script src="{% static 'js/processing_page.js' %}"></script>
    <script src="{%  static 'js/jquery-1.8.3.min.js' %}"></script>
    <script src="{% static 'js/jquery.elevatezoom.js' %}"></script>
    <script>initPaint(document.getElementById('canvas-wrapper'));</script>
{% endblock %}
