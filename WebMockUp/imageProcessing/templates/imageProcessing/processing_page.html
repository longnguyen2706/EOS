{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Processing Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"
          integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
            integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11. 0/umd/popper.min.js"
            integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/bootstrap-slider.js#}
    {#Copy">#}
    {#    </script>#}
    {#        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/bootstrap-slider.min.js"></script>#}
    {#        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/css/bootstrap-slider.css">#}
    {#        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.9.0/css/bootstrap-slider.min.css">#}

    {#    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">#}
    {#  <link rel="stylesheet" href="/resources/demos/style.css">#}
    {#  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>#}
    {#  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>#}
    {#    <script>#}
    {#        $(function () {#}
    {#            $("#slider-range-min").slider({#}
    {#                range: "min",#}
    {#                value: 37,#}
    {#                min: 1,#}
    {#                max: 700,#}
    {#                slide: function (event, ui) {#}
    {#                    $("#amount").val("$" + ui.value);#}
    {#                }#}
    {#            });#}
    {#            $("#amount").val("$" + $("#slider-range-min").slider("value"));#}
    {#        });#}
    {#    </script>#}

    <style>
        #image {
            width: 100%;
        }

        #custom-handle {
            width: 3em;
            height: 1.6em;
            top: 50%;
            margin-top: -.8em;
            text-align: center;
            line-height: 1.6em;
        }
    </style>
</head>
<body>
{% block content %}
    <div class="container-fluid">
        <div class="header">
            <div class="row">
                <h1 style="margin: 20px auto;">Image Processing Demo</h1>
            </div>
        </div>

        <div class="content">
            <div class="row">
                <div class="col-lg-3">
                </div>

                <div class="col-lg-6">

                    <img id="image" class="img-fluid centered"
                         src="data:image/jpeg;charset=utf-8;base64,{{ image_data }}">
                    {#         <img id= "image" src="/media/1947-1_plg6.png" height="400">}#}
                    <br><br>

                </div>

                <div class="col-lg-3">


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Lower threshold</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-lower-thresh" type="range" min="1" max="255" value="30" step="5">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-lower-thresh" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>

                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Upper threshold</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-upper-thresh" type="range" min="1" max="255" value="80" step="5">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-upper-thresh" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>

                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Laplacian</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_laplacian" type="button">Do laplacian</button>
                        </div>
                        <div class="col-lg-2"></div>

                    </div>


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Kmeans</label>
                        </div>
                        <div class="col-lg-5">
                            <input id="slider-kmeans" type="range" min="1" max="10" value="3" step="1">
                        </div>

                        <div class="col-lg-2">
                            <input id="slider-val-kmeans" type="text" readonly
                                   style="border:0; color:#f6931f; font-weight:bold;">
                        </div>

                    </div>


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Label of region to extract: </label>
                        </div>
                        <div class="col-lg-3">
                            <input id="crystal_label" type="number" placeholder="2">
                        </div>
                        <div class="col-lg-1"></div>

                        <div class="col-lg-3 centered">
                            <button id="btn_extract_crystal_mask">Extract</button>
                        </div>

                    </div>


                    {#                        <button id="btn_lower_thresh">Lower threshold</button>#}
                    {#                    <input id="ex5" type="text" data-slider-min="-5" data-slider-max="20" data-slider-step="1" data-slider-value="0"/>#}


                    {##}
                    {#                    <form>#}
                    {#                        Number of clusters: <input id="kmeans_input" type="number" placeholder="3">#}
                    {#                        <button id="btn_kmeans">Kmeans</button>#}
                    {#                    </form>#}
                    {##}


                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> All crystals</label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_all_crystal" type="button">
                                Show crystals
                            </button>
                        </div>

                        <div class="col-lg-2"></div>

                    </div>

                    <div class="form-group row">
                        <div class="col-lg-5">
                            <label class="control-label"> Max area crystal </label>
                        </div>
                        <div class="col-lg-5">
                            <button id="btn_max_crystal" type="button">
                                Show crystal
                            </button>

                        </div>

                        <div class="col-lg-2"></div>

                    </div>
                    <div class="form-group row">

                        <div class="col-lg-5">
                            <button id="btn_undo" type="button" class="btn btn-primary">
                                Undo
                            </button>
                        </div>
                    </div>
                </div>


            </div>

        </div>

    </div>

    </div>

    {##}
    {##}
    {#    <button id="btn_base64" type="button">base64</button>#}
    {#    <div id="imageContainer"></div>#}


{% endblock %}

{#<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>#}
{#<!--#}
{#<script src="{% static 'js/app.js' %}"></script>#}
{#-->#}

{% block javascript %}
    {#<script>#}
    {#$("#ex5").slider();#}
    {##}
    {#</script>#}
    <script>
        $("#slider-lower-thresh").change(function (e) {
            {#            alert($("#slider").val());#}
            $("#slider-val-lower-thresh").val($("#slider-lower-thresh").val());
            e.preventDefault();
            console.log("value", $('#slider-lower-thresh').val());
            $.ajax({
                url: "lower-thresholding/", // the endpoint
                type: "POST", // http method
                data: {input: $('#slider-lower-thresh').val()}, // data sent with the post request

                // handle a successful response
                success: function (data) {
                    {#                    $('#lower_thesh_input').val(''); // remove the value from the input#}
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });
    </script>
    <script>
        $("#btn_laplacian").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "/laplacian",

                success: function (data) {
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                },
                error: function (data) {
                    console.log(data);
                    alert('error');
                }
            });
        });
    </script>


    <script>

        // AJAX for posting
        $("#slider-upper-thresh").change(function (e) {
            {#            alert($("#slider").val());#}
            $("#slider-val-upper-thresh").val($("#slider-upper-thresh").val());
            e.preventDefault();
            console.log("value", $('#slider-upper-thresh').val());
            $.ajax({
                url: "upper-thresholding/", // the endpoint
                type: "POST", // http method
                data: {input: $('#slider-upper-thresh').val()}, // data sent with the post request

                // handle a successful response
                success: function (data) {
                    {#                    $('#upper_thresh_input').val(''); // remove the value from the input#}
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });
    </script>
    <script>
        $("#slider-kmeans").click(function (e) {
            $("#slider-val-kmeans").val($("#slider-kmeans").val());
            e.preventDefault();
            $.ajax({
                url: "kmeans/",
                type: "POST", // http method
                data: {input: $("#slider-kmeans").val()}, // data sent with the post request

                // handle a successful response
                success: function (data) {
                    {#                    $('#slider-kmeans').val(''); // remove the value from the input#}
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });
    </script>

    <script>
        $("#btn_base64").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "/base64",
                success: function (data) {
                    var image = document.createElement('img');
                    image.src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    document.querySelector('#imageContainer').innerHTML = image.outerHTML;//where to insert your image
                    {#                    console.log(data);#}
                },
                error: function (data) {
                    console.log(data);
                    alert('error');
                }
            })
        })

    </script>

    <script>
        $("#btn_undo").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "/undo",
                success: function (data) {
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                },
                error: function (data) {
                    console.log(data);
                    alert('error');
                }
            })
        })

    </script>
    <script>
        $("#btn_extract_crystal_mask").click(function (e) {
            e.preventDefault();
            $.ajax({
                url: "extract-crystal-mask/",
                type: "POST", // http method
                data: {input: $("#crystal_label").val()}, // data sent with the post request

                // handle a successful response
                success: function (data) {
                    $('#lower_thesh_input').val(''); // remove the value from the input
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });
    </script>

    <script>
        $("#btn_all_crystal").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "all-crystal/",

                success: function (data) {
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });

    </script>

    <script>
        $("#btn_max_crystal").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "max-crystal/",

                success: function (data) {
                    document.getElementById("image").src = "data:image/jpeg;charset=utf-8;base64," + data["image_data"];
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error: function (data) {
                    alert('error');
                }
            });
        });

    </script>

{% endblock %}
